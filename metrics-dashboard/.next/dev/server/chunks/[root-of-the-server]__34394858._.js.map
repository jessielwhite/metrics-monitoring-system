{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/jessiewhite/Development/Tech_Screens/Tensorwave/sre-take-home-challenge-15dc00b/www/pages/api/db.ts"],"sourcesContent":["import { MongoClient, Db } from 'mongodb';\n\nconst MONGODB_URI = process.env.MONGODB_URI;\nconst DATABASE_NAME = process.env.DATABASE_NAME;\nconst COLLECTION_NAME = process.env.COLLECTION_NAME;\n\n\nlet cachedClient: MongoClient | null = null;\nlet cachedDb: Db | null = null;\n\nexport async function connectToDatabase(): Promise<{ client: MongoClient; db: Db }> {\n  if (cachedClient && cachedDb) {\n    return { client: cachedClient, db: cachedDb };\n  }\n\n  try {\n    const client = MONGODB_URI ? new MongoClient(MONGODB_URI) : null;\n    await client.connect();\n    const db = client.db(DATABASE_NAME);\n\n    // Test the connection\n    await db.admin().ping();\n\n    cachedClient = client;\n    cachedDb = db;\n\n    console.log('Connected to MongoDB successfully');\n    return { client, db };\n  } catch (error) {\n    console.error('Failed to connect to MongoDB:', error);\n    throw error;\n  }\n}\n\nexport async function getMetricsCollection() {\n  const { db } = await connectToDatabase();\n  return db.collection(COLLECTION_NAME);\n}"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAC3C,MAAM,gBAAgB,QAAQ,GAAG,CAAC,aAAa;AAC/C,MAAM,kBAAkB,QAAQ,GAAG,CAAC,eAAe;AAGnD,IAAI,eAAmC;AACvC,IAAI,WAAsB;AAEnB,eAAe;IACpB,IAAI,gBAAgB,UAAU;QAC5B,OAAO;YAAE,QAAQ;YAAc,IAAI;QAAS;IAC9C;IAEA,IAAI;QACF,MAAM,SAAS,cAAc,IAAI,sHAAW,CAAC,eAAe;QAC5D,MAAM,OAAO,OAAO;QACpB,MAAM,KAAK,OAAO,EAAE,CAAC;QAErB,sBAAsB;QACtB,MAAM,GAAG,KAAK,GAAG,IAAI;QAErB,eAAe;QACf,WAAW;QAEX,QAAQ,GAAG,CAAC;QACZ,OAAO;YAAE;YAAQ;QAAG;IACtB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,MAAM;IACR;AACF;AAEO,eAAe;IACpB,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;IACrB,OAAO,GAAG,UAAU,CAAC;AACvB"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///Users/jessiewhite/Development/Tech_Screens/Tensorwave/sre-take-home-challenge-15dc00b/www/pages/api/metrics.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\nimport { getMetricsCollection } from './db';\nimport { Metric } from './types';\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse<Metric[] | { error: string }>\n) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  try {\n    const collection = await getMetricsCollection();\n\n    // Get query parameters\n    const { range, agent_id, type } = req.query;\n\n    let filter: any = {};\n\n    // Filter by agent_id if provided\n    if (agent_id && typeof agent_id === 'string') {\n      filter.agent_id = agent_id;\n    }\n\n    // Filter by type if provided\n    if (type && typeof type === 'string') {\n      filter.type = type;\n    }\n\n    // Filter by time range if provided\n    if (range && typeof range === 'string') {\n      const now = new Date();\n      let startDate: Date;\n\n      switch (range) {\n        case '1h':\n          startDate = new Date(now.getTime() - 60 * 60 * 1000);\n          break;\n        case '24h':\n          startDate = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n          break;\n        case '7d':\n          startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n          break;\n        default:\n          startDate = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n      }\n\n      filter.timestamp = { $gte: { $date: startDate.toISOString() } };\n    }\n\n    const metrics = await collection\n      .find(filter)\n      .sort({ timestamp: -1 })\n      .limit(1000)\n      .toArray();\n\n    // Convert MongoDB documents to Metric interface\n    const formattedMetrics: Metric[] = metrics.map((doc: any) => ({\n      _id: doc._id?.toString(),\n      timestamp: doc.timestamp?.$date || doc.timestamp,\n      process_id: doc.process_id,\n      process_name: doc.process_name,\n      type: doc.type,\n      utilization: doc.utilization,\n      latency: doc.latency,\n      throughput: doc.throughput,\n      memory_used: doc.memory_used,\n      memory_total: doc.memory_total,\n      temperature: doc.temperature,\n      power_draw: doc.power_draw,\n    }));\n\n    res.status(200).json(formattedMetrics);\n  } catch (error) {\n    console.error('Error fetching metrics:', error);\n    res.status(500).json({ error: 'Failed to fetch metrics' });\n  }\n}"],"names":[],"mappings":";;;;AACA;;AAGe,eAAe,QAC5B,GAAmB,EACnB,GAAkD;IAElD,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC5D;IAEA,IAAI;QACF,MAAM,aAAa,MAAM,IAAA,mIAAoB;QAE7C,uBAAuB;QACvB,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,IAAI,KAAK;QAE3C,IAAI,SAAc,CAAC;QAEnB,iCAAiC;QACjC,IAAI,YAAY,OAAO,aAAa,UAAU;YAC5C,OAAO,QAAQ,GAAG;QACpB;QAEA,6BAA6B;QAC7B,IAAI,QAAQ,OAAO,SAAS,UAAU;YACpC,OAAO,IAAI,GAAG;QAChB;QAEA,mCAAmC;QACnC,IAAI,SAAS,OAAO,UAAU,UAAU;YACtC,MAAM,MAAM,IAAI;YAChB,IAAI;YAEJ,OAAQ;gBACN,KAAK;oBACH,YAAY,IAAI,KAAK,IAAI,OAAO,KAAK,KAAK,KAAK;oBAC/C;gBACF,KAAK;oBACH,YAAY,IAAI,KAAK,IAAI,OAAO,KAAK,KAAK,KAAK,KAAK;oBACpD;gBACF,KAAK;oBACH,YAAY,IAAI,KAAK,IAAI,OAAO,KAAK,IAAI,KAAK,KAAK,KAAK;oBACxD;gBACF;oBACE,YAAY,IAAI,KAAK,IAAI,OAAO,KAAK,KAAK,KAAK,KAAK;YACxD;YAEA,OAAO,SAAS,GAAG;gBAAE,MAAM;oBAAE,OAAO,UAAU,WAAW;gBAAG;YAAE;QAChE;QAEA,MAAM,UAAU,MAAM,WACnB,IAAI,CAAC,QACL,IAAI,CAAC;YAAE,WAAW,CAAC;QAAE,GACrB,KAAK,CAAC,MACN,OAAO;QAEV,gDAAgD;QAChD,MAAM,mBAA6B,QAAQ,GAAG,CAAC,CAAC,MAAa,CAAC;gBAC5D,KAAK,IAAI,GAAG,EAAE;gBACd,WAAW,IAAI,SAAS,EAAE,SAAS,IAAI,SAAS;gBAChD,YAAY,IAAI,UAAU;gBAC1B,cAAc,IAAI,YAAY;gBAC9B,MAAM,IAAI,IAAI;gBACd,aAAa,IAAI,WAAW;gBAC5B,SAAS,IAAI,OAAO;gBACpB,YAAY,IAAI,UAAU;gBAC1B,aAAa,IAAI,WAAW;gBAC5B,cAAc,IAAI,YAAY;gBAC9B,aAAa,IAAI,WAAW;gBAC5B,YAAY,IAAI,UAAU;YAC5B,CAAC;QAED,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IACvB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAA0B;IAC1D;AACF"}}]
}