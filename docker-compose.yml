services:
  metrics-system:
    platform: linux/amd64
    build: 
      context: .
      dockerfile: Dockerfile
      platforms:
        - linux/amd64
    ports:
      - "8080:8080"
      - "50051:50051"
      - "8081:8081"
      - "3000:3000"
    env_file:
      - config.env
    environment:
      - RUST_SERVICE_URL=0.0.0.0:8080
      - GRPC_PORT=50051
      - PORT=8081
      - NEXT_PUBLIC_API_URL=${VERCEL_URL:-http://localhost:8081}
      - GRPC_SERVER=localhost:50051
      - AGENT_ID=agent-docker-1
      - NODE_ENV=production
    networks:
      - metrics-network
    restart: unless-stopped

networks:
  metrics-network:
    driver: bridge